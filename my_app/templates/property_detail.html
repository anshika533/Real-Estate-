{% extends 'common.html' %}
{% block content %}
<!-- GLightbox CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" />

<style>
  .modal-content {
    border-radius: 12px;
  }

  .modal-header h5 {
    font-size: 1rem;
    line-height: 1.4;
  }

  .gslide-image img {
    max-width: 100% !important;
    max-height: 400px !important;
    width: auto;
    height: auto;
    object-fit: contain;
    margin: auto;
  }

  /* Carousel Controls */
  .carousel-control-prev,
  .carousel-control-next {
    display: flex !important;
    justify-content: center;
    align-items: center;
    width: 40px;
    height: 40px;
    background-color: rgba(0, 0, 0, 0.4);
    border-radius: 50%;
    top: 50%;
    transform: translateY(-50%);
    z-index: 2;
  }

  .carousel-control-prev-icon,
  .carousel-control-next-icon {
    background-size: 100% 100%;
    width: 20px;
    height: 20px;
  }

.glightbox-clean .gprev,
.glightbox-clean .gnext {
  display: flex !important;
  justify-content: center;
  align-items: center;
  width: 40px;
  height: 40px;
  background-color: rgba(0, 0, 0, 0.4);
  color: white;
  font-size: 22px;
  border-radius: 50%;
  z-index: 10000;
  transition: background 0.3s ease;
}

.glightbox-clean .gprev:hover,
.glightbox-clean .gnext:hover {
  background-color: rgba(0, 0, 0, 0.8);
}

.glightbox-clean .gprev {
  left: 10px;
}

.glightbox-clean .gnext {
  right: 10px;
}

.glightbox-clean .gprev,
.glightbox-clean .gnext {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
}

@media (max-width: 576px) {
  .glightbox-clean .gprev,
  .glightbox-clean .gnext {
    width: 36px;
    height: 36px;
    font-size: 18px;
  }
}


  @media (max-width: 576px) {
    .carousel-control-prev,
    .carousel-control-next {
      display: flex !important;
    }

    .col-md-5 {
      overflow: visible !important;
    }
  }
</style>

<!-- MAIN CONTENT -->
<div class="container mt-5">
  <div class="row g-4">
    <!-- LEFT: Property Info -->
    <div class="col-lg-8">
      <div class="bg-white p-4 shadow rounded border">
        <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center gap-2 gap-md-5">
          <h3 class="text-success fw-bold mb-2 mb-md-0">Please Contact to Owner for Price</h3>
          <a href="#" class="btn btn-outline-success px-4 py-2" data-bs-toggle="modal" data-bs-target="#whatsappModal">Price</a>
        </div>

        <p class="mb-2 text-secondary">
          {{ property.area }} Sq-ft Residential Plot/Land For Sale in <strong>{{ property.location.name }}</strong>
        </p>

        <!-- Image Carousel with Zoom -->
        <div class="row">
          <div class="col-md-5 d-flex justify-content-center mt-3 mb-3">
            {% if property.images.all %}
            <div id="carouselImages" class="carousel slide" data-bs-ride="carousel" style="width: 100%; max-width: 500px;">
              <div class="carousel-inner">
                {% for img in property.images.all %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                  <a href="{{ img.image.url }}" class="glightbox" data-gallery="property">
                    <img src="{{ img.image.url }}" class="d-block w-100 rounded" alt="Property Image" style="height: 200px; object-fit: cover;" />
                  </a>
                </div>
                {% endfor %}
              </div>
              <button class="carousel-control-prev" type="button" data-bs-target="#carouselImages" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carouselImages" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
              </button>
            </div>
            {% else %}
            <img src="https://via.placeholder.com/600x400?text=No+Image" class="img-fluid rounded" alt="No image available" />
            {% endif %}
          </div>

          <!-- Property Details -->
          <div class="col-md-7">
            <div class="row">
              <div class="col-6 mb-2"><strong>City:</strong><br />{{ property.city }}</div>
              <div class="col-6 mb-2"><strong>Location:</strong><br />{{ property.location }}</div>
              <div class="col-6 mb-2"><strong>Plot Area:</strong><br />{{ property.area }} sqft</div>
              <div class="col-6 mb-2"><strong>Facing:</strong><br />{{ property.facing }}</div>
              <div class="col-6 mb-2"><strong>Ownership:</strong><br />{{ property.ownership }}</div>
              <div class="col-6 mb-2"><strong>Transaction Type:</strong><br />{{ property.transaction_type }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Property Description -->
      <div class="mt-4 p-4 bg-white shadow rounded border">
        <h5 class="mb-3 text-success">Property Description</h5>
        <p class="text-dark">{{ property.description }}</p>
      </div>
    </div>

    <!-- RIGHT: Contact Box -->
    <div class="col-lg-4">
      <div class="p-4 bg-white shadow border rounded">
        <h5 class="mb-2">Contact Agent</h5>
        <p><strong>Landmark Real Estate</strong></p>
        <p class="text-muted">+91-96XXXXXXXX</p>
        <a href="#" class="btn btn-outline-primary px-4 mb-2" data-bs-toggle="modal" data-bs-target="#whatsappModal">Get Phone No.</a>
        <a href="https://wa.me/91{{ property.agent_phone }}?text=Hi, I'm interested in the property: {{ property.title }}" class="btn btn-success w-100" target="_blank">WhatsApp</a>
      </div>
    </div>
  </div>
</div>

<!-- Modal for Lead Form -->
<div class="modal fade" id="whatsappModal" tabindex="-1" aria-labelledby="whatsappModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-success" id="whatsappModalLabel">ðŸ’¬ Enter your details to get Contact Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form method="POST">
        {% csrf_token %}
        {{ lead_form.as_p }}
        <button type="submit" name="lead_form_submit" class="btn btn-primary">Request Contact</button>
      </form>
    </div>
  </div>
</div>

<!-- Related Properties -->
<div class="container mt-5">
  <h4 class="text-success mb-4">Related Properties in {{ property.city.name }}</h4>
  <div class="row">
    {% for prop in related_properties %}
    <div class="col-md-4 mb-4">
      <div class="card h-100">
        {% if prop.images.all %}
        <img src="{{ prop.images.first.image.url }}" class="card-img-top" style="height: 200px; object-fit: cover;" />
        {% else %}
        <img src="https://via.placeholder.com/400x250?text=No+Image" class="card-img-top" />
        {% endif %}
        <div class="card-body">
          <h5>{{ prop.title }}</h5>
          <p>â‚¹{{ prop.price }}</p>
          <p><strong>Location:</strong> {{ prop.location.name }}</p>
          <a href="{% url 'property_detail' prop.pk %}" class="btn btn-outline-primary btn-sm">View Details</a>
        </div>
      </div>
    </div>
    {% empty %}
    <p class="text-muted">No related properties found.</p>
    {% endfor %}
  </div>
</div>

<!-- GLightbox Script -->
<script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
<script>
  const lightbox = GLightbox({
    selector: '.glightbox',
    loop: true,
    touchNavigation: true,
    autoplayVideos: false
  });
</script>
{% endblock %}
